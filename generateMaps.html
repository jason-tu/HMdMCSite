<!DOCTYPE html>
<html>
<head>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Bootstrap -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<!-- layout style -->
		<link rel="stylesheet" type="text/css" href="mystyle.css">

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
		<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
		<script src="Classes/CommonStructs.js"></script>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

		<title>Generate Maps</title>

		<link rel="icon" href="images/mario.ico">

	</head>



	<script>

		var choseGame;

		var MdMC = true;
		var HMdMC = false;
		var MRF = false;

		var fileContent;
		var tileTypes = [];
		var hierTileTypes = [];
		var TopDown = false;
		var NumberMatrices = 0;
		var DependencyMatrices = [];
		var DepComplexities = [];
		var Hierarchical = false;
		var Rows = [];


		var Totals = [];
		var Probabilities = [];
		var HierTotals = [];
		var HierProbabilities = [];

		var TotalMatrix = [];
		var ProbMatrix = [];
		var HierTotalMatrix = [];
		var HierProbMatrix = [];
		var NumberOfRowSplits = 1;

		function changeTrainingMaps() {
			var x = document.getElementById("fileinput");
			if(x.disabled == true){
				x.disabled = false;
			}else{
				x.disabled = true;
			}

		}

		function samplingReady(){
			var userYourOwnMapsRadio = document.getElementById("userYourOwnMapsRadio");
			tileTypes = [];

			var file = document.getElementById("fileinput").files[0];
			if(file && userYourOwnMapsRadio.checked == true || userYourOwnMapsRadio.checked == false){
				var samplingMapsButton = document.getElementById("samplingMapsButton");
				samplingMapsButton.disabled = false;
				MdMCExperiments();
			}
			else{
				alert("Please choose Training Maps!");
			}
		}

		


		function ResizeVectors(hier){

			Totals.length = NumberMatrices;
			Probabilities.length = NumberMatrices;
			if (hier){
				HierTotals.length = NumberMatrices;
				HierProbabilities.length = NumberMatrices;
			}
		}


		function SetTotalsTopLevel(){


		}

		function InitFiles(WhichDepMat){

			TotalMatrix.push([]);
			ProbMatrix.push([]);

			HierTotalMatrix.push([]);
			HierProbMatrix.push([]);

			if(Hierarchical == false)
				for(var k = 0; k < NumberOfRowSplits; k++){

					TotalMatrix[WhichDepMat].push([]);
					ProbMatrix[WhichDepMat].push([]);

					for (var i = 0; i < Rows[WhichDepMat]; i++){

						TotalMatrix[WhichDepMat][k].push([]);
						ProbMatrix[WhichDepMat][k].push([]);

						for (var j = 0; j <= tileTypes.length; j++){
							if(j < tileTypes.length){
								ProbMatrix[WhichDepMat][k][i].push(0);
							}
							TotalMatrix[WhichDepMat][k][i].push(0);
						}
					}
				}else{
					for(var k = 0; k < NumberOfRowSplits; k++){

						HierTotalMatrix[WhichDepMat].push([]);
						HierProbMatrix[WhichDepMat].push([]);

						for (var i = 0; i < Rows[WhichDepMat]; i++){

							HierTotalMatrix[WhichDepMat][k].push([]);
							HierProbMatrix[WhichDepMat][k].push([]);

							for (var j = 0; j <= hierTileTypes.length; j++){
								if(j < hierTileTypes.length){
									HierProbMatrix[WhichDepMat][k][i].push(0);
								}
								HierTotalMatrix[WhichDepMat][k][i].push(0);
							}
						}
					}
				}


				//document.getElementById("textOutputTab").innerHTML = TotalMatrix;
			}

			function SetRows(hier){
				var types = 0;

				if(hier == true){
					types = hierTileTypes.length;
				}else{
					types = tileTypes.length;
				}

				for (var i = 0; i < NumberMatrices; i++){
					Rows.push(1);
					for (var j = 0; j < DepComplexities[i]; j++)
						Rows[i] *= types;

				}

			//document.getElementById("textOutputTab").innerHTML = Rows;
		}
		
		function SetDepMatrix(DepMatrix){

			var TempDepMat = [[],[],[],[],[]];
			for (var i = 0; i < 5; i++)
				TempDepMat[i].length = 3;

	for (var i = 0; i < 5; i++){			//initialize array to all 0's
		for (var j = 0; j < 3; j++)
			TempDepMat[i][j] = 0;
	}
	TempDepMat[2][2] = 2;				//block we are finding the probability for
	
	if (TopDown == false){				//if we are generating from the top down...	
		if (DepMatrix == 1)				//use the previous block to determine probability
			TempDepMat[2][1] = 1;
		else if (DepMatrix == 2){		//use the previous block and the block above to determine probability
			TempDepMat[2][1] = 1;	//previous
			TempDepMat[1][2] = 1;	//above
		} else if (DepMatrix == 3){		//use previous block, and previous above block, and above block to determine probability
			TempDepMat[2][1] = 1;	//previous
			TempDepMat[1][1] = 1;	//previous above
			TempDepMat[1][2] = 1;	//above
		} 						
	}else{					//if we are generating from the bottom up
		
		if (DepMatrix == 1)			//only use the previous block to determine probability
			TempDepMat[2][1] = 1;
        else if (DepMatrix == 2){		//use the previous block and the block below to determine probability
			TempDepMat[2][1] = 1;	//previous
			TempDepMat[3][2] = 1;	//below
		} else if (DepMatrix == 3){		//use previous block, and previous below block, and below block to determine probability
			TempDepMat[2][1] = 1;	//previous
			TempDepMat[3][1] = 1;	//previous below
			TempDepMat[3][2] = 1;	//below
		}
	}

	NumberMatrices++;
	DependencyMatrices.push(TempDepMat);

	if(DepMatrix == 0)
		DepComplexities.push(0);
	else if(DepMatrix == 1)
		DepComplexities.push(1);
	else if(DepMatrix == 2)
		DepComplexities.push(2);
	else if(DepMatrix == 3)
		DepComplexities.push(3);


//document.getElementById("textOutputTab").innerHTML = DependencyMatrices;

}



function samplesGenerated(){

			//alert(fileContent);
			//tileTypes.indexOf("a");


			var networkStructure = 1;

			Hierarchical = HMdMC;

			NumberOfRowSplits = document.getElementById("rowSplits").value;


			//------------------------- FIND TILES TYPES ----------------------------------

			
			var strLength = fileContent.length;
			var c;

			
			if(Hierarchical == false){
				for(var i = 0; i < strLength; i++){
					c = fileContent[i];
					if(tileTypes.indexOf(fileContent[i]) == -1 && c != '\n' && c != '\t' && c != '\r'){
						tileTypes.push(fileContent[i]);
					}
				}

				if(tileTypes.indexOf('S') == -1){
					tileTypes.push('S');	
				}
			}else{
				for(var i = 0; i < strLength; i++){
					c = fileContent[i];
					if(hierTileTypes.indexOf(fileContent[i]) == -1 && c != '\n' && c != '\t' && c != '\r'){
						hierTileTypes.push(fileContent[i]);
					}
				}

				if(hierTileTypes.indexOf('S') == -1){
					hierTileTypes.push('S');	
				}

			}
			
			
			//document.getElementById("textOutputTab").innerHTML = fileContent;
			//document.getElementById("textOutputTab").innerHTML = tileTypes;

			//------------------------- FIND TILES TYPES ----------------------------------

			for(var i = 0; i < networkStructure; i++){
				SetDepMatrix(i);
			}
			
			SetRows(Hierarchical);

			for(var i = 0; i < NumberMatrices; i++){
				InitFiles(i);
			}



			var saveText = document.getElementById("saveText");
			var saveGraphic = document.getElementById("saveGraphic");

			saveText.disabled = false;
			saveGraphic.disabled = false;

		}


		function MdMCExperiments(){

			var trainingFolderNameValue = document.getElementById("fileinput").value;
			var rowSplitsValue = document.getElementById("rowSplits").value;
			var lookaheadValue = document.getElementById("lookahead").value; 
			var networkStructureValue = "2"; 
			var trainingMapsValue = "10"; 
			var toGenerateValue = "100"; 
			var heightValue = document.getElementById("height").value; 
			var widthValue = document.getElementById("width").value;
			var userYourOwnMapsRadio = document.getElementById("userYourOwnMapsRadio");



			if(userYourOwnMapsRadio.checked == false){

				jQuery.get('http://localhost/HMdMC/foo.txt', function(data) {
					fileContent = data;
				});
			}else{

				var file = document.getElementById("fileinput").files[0];
				if (file) {
					var reader = new FileReader();
					reader.readAsText(file, "UTF-8");
					reader.onload = function (evt) {
						fileContent = evt.target.result;

					}
					reader.onerror = function (evt) {
						fileContent = "Fail to Load File!"
					}

				}

			}


		}

		//--------------------- SITE FUNCTIONS -------------------------------------------

		function gameChanged(selectedValue){
			choseGame = selectedValue;
			if(selectedValue == "other"){
				document.getElementById("defaultMaps").disabled = true;
				document.getElementById("userYourOwnMapsRadio").checked = true;
				document.getElementById("fileinput").disabled = false;
			}else{
				document.getElementById("defaultMaps").disabled = false;
				
			}
		}

		function changeToMRF(){
			var rowSplits = document.getElementById("rowSplits"); 
			var lookahead = document.getElementById("lookahead");
			var numberOfClusters = document.getElementById("numberOfClusters");
			var distanceMetric = document.getElementById("distanceMetric");
			var tileSize = document.getElementById("tileSize");
			var manualRadio = document.getElementById("manualRadio");
			var parameters = document.getElementById("parameters");
			var	clusteringBasedRadio = document.getElementById("clusteringBasedRadio");
			var formHighLevelConvertion = document.getElementById("formHighLevelConvertion");

			rowSplits.disabled = true;
			lookahead.disabled = true;
			numberOfClusters.disabled = true;
			distanceMetric.disabled = true;
			tileSize.disabled = true;
			manualRadio.disabled = true;
			parameters.disabled = true;
			clusteringBasedRadio.disabled = true;
			formHighLevelConvertion.disabled = true;

			MdMC = false;
			HMdMC = false;
			MRF = true;

		}

		function changeToMdMC(){
			var rowSplits = document.getElementById("rowSplits"); 
			var lookahead = document.getElementById("lookahead");
			var numberOfClusters = document.getElementById("numberOfClusters");
			var distanceMetric = document.getElementById("distanceMetric");
			var tileSize = document.getElementById("tileSize");
			var manualRadio = document.getElementById("manualRadio");
			var parameters = document.getElementById("parameters");
			var	clusteringBasedRadio = document.getElementById("clusteringBasedRadio");
			var formHighLevelConvertion = document.getElementById("formHighLevelConvertion");

			rowSplits.disabled = false;
			lookahead.disabled = false;
			numberOfClusters.disabled = true;
			distanceMetric.disabled = true;
			tileSize.disabled = true;
			manualRadio.disabled = true;
			parameters.disabled = true;
			clusteringBasedRadio.disabled = true;
			formHighLevelConvertion.disabled = true;

			MdMC = true;
			HMdMC = false;
			MRF = false;

		}

		function changeToHMdMC(){
			var rowSplits = document.getElementById("rowSplits"); 
			var lookahead = document.getElementById("lookahead");
			var numberOfClusters = document.getElementById("numberOfClusters");
			var distanceMetric = document.getElementById("distanceMetric");
			var tileSize = document.getElementById("tileSize");
			var manualRadio = document.getElementById("manualRadio");
			var parameters = document.getElementById("parameters");
			var	clusteringBasedRadio = document.getElementById("clusteringBasedRadio");
			var formHighLevelConvertion = document.getElementById("formHighLevelConvertion");

			rowSplits.disabled = false;
			lookahead.disabled = false;
			numberOfClusters.disabled = false;
			distanceMetric.disabled = false;
			tileSize.disabled = false;
			manualRadio.disabled = false;
			parameters.disabled = false;
			clusteringBasedRadio.disabled = false;
			formHighLevelConvertion.disabled = true;

			manualRadio.checked = true;
			clusteringBasedRadio.checked = false;

			MdMC = false;
			HMdMC = true;
			MRF = false;

		}

		function changeHighLevelMapsConvertion(){
			var manualRadio = document.getElementById("manualRadio");
			var parameters = document.getElementById("parameters");
			var	clusteringBasedRadio = document.getElementById("clusteringBasedRadio");
			var formHighLevelConvertion = document.getElementById("formHighLevelConvertion");

			if(parameters.disabled == true){
				parameters.disabled = false;
				formHighLevelConvertion.disabled = true;
			}
			else{
				parameters.disabled = true;
				formHighLevelConvertion.disabled = false;
			}

		}

	</script>

</script>

<body>

	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="home.html">HMdMC Site</a>
			</div>
			<ul class="nav navbar-nav">
				<li id="homeButton"><a href="home.html">Home</a></li>
				<li class="active"><a href="#">Generate Maps</a></li>
				<li><a href="help.html">Help</a></li> 
			</ul>
		</div>
	</nav>




	<section>

		<div id = "container">

			<ul class="nav nav-tabs" >
				<li class="active" ><a data-toggle="tab" href="#home">Options</a></li>
				<li><a data-toggle="tab" href="#menu1">Text Output</a></li>
				<li><a data-toggle="tab" href="#menu2">Graphic Output</a></li>
			</ul>


			<div class="tab-content">
				<div id="home" class="tab-pane fade in active">

					<fieldset class="scheduler-border" id="chooseAGame">
						<legend class="scheduler-border">Choose a Game</legend>

						<select class="form-control" id="formChooseAGame" onchange="gameChanged(this.value)">
							<option value="kidIcarus" >Kid Icarus</option>
							<option value="lorerunner">Loderunner</option>
							<option value="superMarioBros">Super Mario Bros</option>
							<option value="other">Other</option>
						</select>

					</fieldset>

					<fieldset class="scheduler-border" id="trainingMaps">
						<legend class="scheduler-border">Training Maps</legend>

						<div class="radio" >
							<label><input type="radio" name="optradio" value="default" checked onchange="changeTrainingMaps()" id = "defaultMaps">Use default training maps</label>
						</div>
						<div class="radio">
							<label><input type="radio" name="optradio" value="userMaps" onchange="changeTrainingMaps()" id = "userYourOwnMapsRadio">Use your own maps</label>
						</div>

						<input type="file" id="fileinput" disabled = true >

					</fieldset>

					<fieldset class="scheduler-border" id="chooseAMethod">
						<legend class="scheduler-border">Choose a Method</legend>
						<div class="radio" >
							<label><input type="radio" name="RadioChooseAMethod" value="MdMC" checked onchange="changeToMdMC()"> Multi-Dimensional Markov chains (MdMC)<br></label>
						</div>
						<div class="radio" >
							<label><input type="radio" name="RadioChooseAMethod" value="HMdMC" onchange="changeToHMdMC()"> Hierarchical Multi-Dimensional Markov chains (HMdMC)<br></label>
						</div>
						<div class="radio" >
							<label><input type="radio" name="RadioChooseAMethod" value="MRF" onchange="changeToMRF()"> Markov Random Fields (MRF)<br></label>
						</div>

					</fieldset>

					<fieldset class="scheduler-border" id="mapSize">
						<legend class="scheduler-border">Map Size</legend>

						<div class="input-group">
							<span class="input-group-addon" >Height</span>
							<input type="text" class="form-control" id="height" aria-describedby="height" value = "12">
						</div>
						<br>
						<div class="input-group">
							<span class="input-group-addon" >Width&nbsp</span>
							<input type="text" class="form-control" id = "width" aria-describedby="width" value = "210">
						</div>
					</fieldset>



					<fieldset class="scheduler-border" id="experimentalSetUps">
						<legend class="scheduler-border">Experimental Set-Ups</legend>

						<div id="experimentalOptions">

							<div class="input-group">
								<span class="input-group-addon" >Row Splits&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</span>
								<input type="text" class="form-control"  aria-describedby="rowSplits" id="rowSplits" value = "12">
							</div>
							<br>
							<div class="input-group">
								<span class="input-group-addon" >Lookahead&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</span>
								<input type="text" class="form-control"  aria-describedby="lookahead" id="lookahead" value = "3">
							</div>
							<br>	
							<div class="input-group">
								<span class="input-group-addon" >Number of Clusters</span>
								<input type="text" class="form-control"  aria-describedby="numberOfClusters" id="numberOfClusters" disabled = true>
							</div>	

						</div>

						<div id="experimentalOptions">


							<div class="input-group">
								<span class="input-group-addon" >Distance Metric&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</span>
								<input type="text" class="form-control"  aria-describedby="distanceMetric" id="distanceMetric" disabled = true>
							</div>
							<br>
							<div class="input-group">
								<span class="input-group-addon" >Tile Size&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</span>
								<input type="text" class="form-control"  aria-describedby="tileSize"  id="tileSize" disabled = true>
							</div>


						</div>

						<fieldset class="scheduler-border" id="experimentalFieldset">
							<legend class="scheduler-border">Converting to High-Level Maps</legend>

							<div id="highLevelConvertion">

								<div class="radio" >
									<label><input type="radio" name="optradioExperimental" value="manual" checked disabled = true id="manualRadio" onchange = "changeHighLevelMapsConvertion()">Manual</label>
								</div>
							</div>

							<div id="highLevelConvertion2">

								<div class="input-group">
									<span class="input-group-addon"  >Parameters</span>
									<input type="text" class="form-control"  aria-describedby="Parameters" id="parameters" disabled = true>
								</div>
							</div>



							<div id="highLevelConvertion">

								<div class="radio">
									<label><input type="radio" name="optradioExperimental" value="clusteringBased" disabled = true id="clusteringBasedRadio" onchange = "changeHighLevelMapsConvertion()">Clustering-based</label>
								</div>	

							</div>


							<div id="highLevelConvertion2">

								<select class="form-control" id="formHighLevelConvertion" disabled = true>
									<option value="direct">Direct</option>
									<option value="histogram">Histogram</option>
									<option value="markov">Markov</option>
									<option value="shape">Shape</option>
									<option value="weighted">Weighted</option>	
								</select>


							</div>

						</fieldset>

					</fieldset>


					<div id="divButtons">
						<button type="button" class="btn btn-primary btn-block" id="trainingMapsButton" onclick = "samplingReady()">Training Maps</button>
					</div>
					<div id="divButtons2">
						<button type="button" class="btn btn-primary btn-block" id="samplingMapsButton" disabled = true onclick = "samplesGenerated()">Sampling Maps</button>
					</div>


				</div>
				<div id="menu1" class="tab-pane fade" >

					<div id="textOutputTab">

					</div>
					<div id="divButtons2">
						<button type="button" class="btn btn-primary btn-block" id="saveText" disabled = true>Save Text Output</button>
					</div>

				</div>
				<div id="menu2" class="tab-pane fade" id="graphicOutputTab" >

					<div id="textOutputTab">

					</div>
					<div id="divButtons2">
						<button type="button" class="btn btn-primary btn-block" id="saveGraphic" disabled = true>Save Graphic Output</button>
					</div>

				</div>
			</div>



		</div>
	</section>


	<footer>
		Drexel 2016 
	</footer>

</body>

</html>
